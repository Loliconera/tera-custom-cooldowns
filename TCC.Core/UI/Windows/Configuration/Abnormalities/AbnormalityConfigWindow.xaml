<local:TccWindow x:Class="TCC.UI.Windows.Configuration.Abnormalities.AbnormalityConfigWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:abnormVm="clr-namespace:TCC.ViewModels.Configuration.Abnormalities"
                 xmlns:abnormWin="clr-namespace:TCC.UI.Windows.Configuration.Abnormalities"
                 xmlns:controls="clr-namespace:TCC.UI.Controls"
                 xmlns:converters="clr-namespace:TCC.UI.Converters"
                 xmlns:converters1="clr-namespace:Nostrum.WPF.Converters;assembly=Nostrum.WPF"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:extensions="clr-namespace:Nostrum.WPF.Extensions;assembly=Nostrum.WPF"
                 xmlns:local="clr-namespace:TCC.UI.Windows"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 Title="Configure effects"
                 Width="1000"
                 Height="644"
                 d:DataContext="{d:DesignInstance abnormVm:AbnormalityConfigViewModel}"
                 SizeToContent="Manual"
                 Style="{StaticResource BaseWindowStyle}"
                 mc:Ignorable="d">
    <Window.Resources>
        <Color x:Key="IntermediateAnimationColor">
            #012381A3
        </Color>
        <DataTemplate x:Key="ClassToggleTemplate"
                      DataType="{x:Type abnormVm:AbnormalityWhitelistToggle}">
            <Button Margin="0"
                    Padding="4"
                    extensions:ButtonExtensions.CornerRadius="4"
                    extensions:ButtonExtensions.HighlightBrush="#1fff"
                    Command="{Binding ToggleWhitelistedCommand}"
                    Style="{StaticResource NostrumMainButtonStyle}">
                <Path x:Name="ClassIcon"
                      Data="{Binding Class, Converter={StaticResource ClassToSvg}}"
                      Fill="#5fff"
                      Opacity=".3" />
            </Button>
            <DataTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="ClassIcon" Property="Opacity" Value=".5" />
                    <Setter TargetName="ClassIcon" Property="Fill" Value="{Binding Class, Converter={StaticResource ClassToFill}}" />
                </Trigger>
                <DataTrigger Binding="{Binding IsWhitelisted}"
                             Value="True">
                    <Setter TargetName="ClassIcon" Property="Opacity" Value="1" />
                    <Setter TargetName="ClassIcon" Property="Fill" Value="{Binding Class, Converter={StaticResource ClassToFill}}" />
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>
        <DataTemplate x:Key="AbnormalityTemplate"
                      DataType="{x:Type abnormVm:AbnormalityViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Rectangle x:Name="icon"
                           Width="26"
                           Height="26"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           RadiusX="4"
                           RadiusY="4"
                           Stroke="{Binding Abnormality.Type, Converter={StaticResource AbnormalityTypeToStrokeColor}}"
                           StrokeThickness="1">
                    <Shape.Fill>
                        <ImageBrush ImageSource="{Binding Abnormality.IconName, Converter={StaticResource IconNameToPath}}" />
                    </Shape.Fill>
                </Rectangle>
                <TextBlock Grid.Column="1"
                           Margin="5 0"
                           VerticalAlignment="Center"
                           Foreground="#9fff">
                    <Run Text="{Binding Abnormality.Name}" />
                    <LineBreak FontSize="10" />
                    <Run FontSize="8"
                         Foreground="#4fff"
                         Text="{Binding Abnormality.Id}" />
                </TextBlock>

                <ToggleButton Grid.Column="2"
                              Margin="3 0"
                              Padding="6"
                              VerticalAlignment="Center"
                              controls:ToggleButtonExtensions.CheckedBrush="Transparent"
                              controls:ToggleButtonExtensions.CornerRadius="4"
                              controls:ToggleButtonExtensions.HighlightBrush="#1fff"
                              IsChecked="{Binding IsFavorite, Mode=TwoWay}"
                              IsEnabled="{Binding CanMarkAsFavorite, Converter={StaticResource BoolToVisibility}}"
                              Visibility="{Binding CanMarkAsFavorite, Converter={StaticResource BoolToVisibility}}">
                    <Path Width="14"
                          Height="14"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Data="{StaticResource SvgStar}"
                          Stretch="Uniform">
                        <Path.Style>
                            <Style BasedOn="{StaticResource NostrumDefaultPathStyle}"
                                   TargetType="Path">
                                <Setter Property="Fill" Value="#2fff" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsFavorite}"
                                                 Value="True">
                                        <Setter Property="Fill" Value="Orange" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Path.Style>
                    </Path>
                </ToggleButton>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="AbnormalityDetailsTemplate"
                      DataType="{x:Type abnormVm:AbnormalityViewModel}">
            <Grid ClipToBounds="False">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="85" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Rectangle x:Name="icon"
                           Grid.RowSpan="2"
                           Width="42"
                           Height="42"
                           Margin="10 10 6 10"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           RadiusX="8"
                           RadiusY="8"
                           Stroke="{Binding Abnormality.Type, Converter={StaticResource AbnormalityTypeToStrokeColor}}"
                           StrokeThickness="1">
                    <Rectangle.Fill>
                        <ImageBrush ImageSource="{Binding Abnormality.IconName, Converter={StaticResource IconNameToPath}}" />
                    </Rectangle.Fill>
                </Rectangle>

                <TextBlock Grid.Column="1"
                           Margin="5 10 5 0"
                           VerticalAlignment="Top"
                           FontSize="14"
                           FontWeight="DemiBold"
                           Foreground="#9fff"
                           TextWrapping="Wrap">
                    <Run Text="{Binding Abnormality.Name}" />
                    <LineBreak />
                    <Run FontSize="9"
                         Foreground="#3fff"
                         Text="{Binding Abnormality.Id}" />
                </TextBlock>

                <ScrollViewer Grid.Row="1"
                              Grid.Column="1"
                              VerticalScrollBarVisibility="Auto">

                    <TextBlock x:Name="AbDescrText"
                               Margin="5 0 10 0"
                               VerticalAlignment="Top"
                               controls:TextBlockExtensions.BindableInlines="{Binding Abnormality.ToolTip, Converter={converters:TooltipTextConverter}}"
                               Foreground="#9fff"
                               TextWrapping="Wrap"
                               UseLayoutRounding="False" />
                </ScrollViewer>
                <Separator Grid.Row="2"
                           Grid.ColumnSpan="2"
                           Margin="8 5 8 0"
                           VerticalAlignment="Bottom"
                           Background="#1fff"
                           UseLayoutRounding="True" />

                <!--  Favorite  -->
                <Button Grid.Row="3"
                        Grid.ColumnSpan="2"
                        Margin="8 6 8 6"
                        Padding="10 5"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Stretch"
                        VerticalContentAlignment="Center"
                        extensions:ButtonExtensions.CornerRadius="6"
                        extensions:ButtonExtensions.HighlightBrush="#10ffffff"
                        Background="#08ffffff"
                        Command="{Binding MarkAsFavoriteCommand}"
                        IsHitTestVisible="{Binding CanMarkAsFavorite}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Path Grid.RowSpan="2"
                              Width="14"
                              Height="14"
                              Margin="0 2 7 0"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Top"
                              Data="{StaticResource SvgStar}"
                              Stretch="Uniform">
                            <Path.Style>
                                <Style BasedOn="{StaticResource NostrumDefaultPathStyle}"
                                       TargetType="Path">
                                    <Setter Property="Fill" Value="#666" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsFavorite}"
                                                     Value="True">
                                            <Setter Property="Fill" Value="Orange" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Path.Style>
                        </Path>
                        <TextBlock Grid.Column="1"
                                   FontWeight="DemiBold"
                                   Foreground="#9fff"
                                   Text="Mark as favorite" />
                        <TextBlock Grid.Row="1"
                                   Grid.Column="1"
                                   FontSize="11"
                                   Foreground="#5fff"
                                   TextWrapping="Wrap">
                            <Run Text="Buffs marked as favorite will be displayed with a yellow border and will always be at the beginning of the buff list." />
                            <LineBreak />
                            <Run Text="Debuffs cannot be marked as favorite." />
                        </TextBlock>
                    </Grid>
                    <Button.Style>
                        <Style BasedOn="{StaticResource NostrumMainButtonStyle}"
                               TargetType="Button">
                            <!--<Setter Property="Opacity" Value=".5" />-->
                            <!--<Style.Triggers>
                                <DataTrigger Binding="{Binding IsFavorite}"
                                             Value="True">
                                    <Setter Property="Opacity" Value="1" />
                                </DataTrigger>
                            </Style.Triggers>-->
                        </Style>
                    </Button.Style>
                </Button>

                <!--  Collapse  -->
                <Border Grid.Row="4"
                        Grid.ColumnSpan="2"
                        Margin="8 0 8 6"
                        Padding="10 5"
                        HorizontalAlignment="Stretch"
                        Background="#08ffffff"
                        CornerRadius="6">
                    <Grid HorizontalAlignment="Stretch">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Path Grid.RowSpan="2"
                              Width="14"
                              Height="14"
                              Margin="0 4 7 0"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Top"
                              Data="{StaticResource SvgCollapsibleAbnormality}"
                              Stretch="Uniform" />
                        <TextBlock Grid.Column="1"
                                   FontWeight="DemiBold"
                                   Foreground="#9fff"
                                   Text="Mark as collapsible" />
                        <TextBlock Grid.Row="2"
                                   Grid.Column="1"
                                   FontSize="11"
                                   Foreground="#5fff"
                                   TextWrapping="Wrap">
                            <Run Text="Effects marked as collapsible will not be displayed until you pass your mouse over the effects bars." />
                        </TextBlock>
                        <UniformGrid Grid.Row="1"
                                     Grid.Column="1"
                                     Margin="0 5"
                                     Rows="1">
                            <ToggleButton Margin="0 0 3 0"
                                          Padding="10"
                                          HorizontalContentAlignment="Stretch"
                                          controls:ToggleButtonExtensions.CheckedBrush="{StaticResource DefensiveStanceBrush}"
                                          controls:ToggleButtonExtensions.CornerRadius="4"
                                          controls:ToggleButtonExtensions.HighlightBrush="#1fff"
                                          Background="#08ffffff"
                                          FontWeight="DemiBold"
                                          IsChecked="{Binding SelfConfigurator.IsCollapsible}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Path Width="16"
                                          Height="12">
                                        <Path.Style>
                                            <Style BasedOn="{StaticResource {x:Type Path}}"
                                                   TargetType="Path">
                                                <Setter Property="Fill" Value="#5fff" />
                                                <Setter Property="Data" Value="{StaticResource SvgUser}" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SelfConfigurator.IsCollapsible}"
                                                                 Value="True">
                                                        <Setter Property="Fill" Value="#fff" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Path.Style>
                                    </Path>

                                    <TextBlock Grid.Column="1"
                                               Padding="8 0"
                                               Text="for yourself" />
                                </Grid>
                            </ToggleButton>
                            <ToggleButton Margin="3 0 0 0"
                                          Padding="10"
                                          HorizontalContentAlignment="Stretch"
                                          controls:ToggleButtonExtensions.CornerRadius="4"
                                          controls:ToggleButtonExtensions.HighlightBrush="#1fff"
                                          Background="#08ffffff"
                                          FontWeight="DemiBold"
                                          IsChecked="{Binding GroupConfigurator.IsCollapsible}">

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Path Width="16"
                                          Height="16">
                                        <Path.Style>
                                            <Style BasedOn="{StaticResource {x:Type Path}}"
                                                   TargetType="Path">
                                                <Setter Property="Fill" Value="#5fff" />
                                                <Setter Property="Data" Value="{StaticResource SvgUsers}" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding GroupConfigurator.IsCollapsible}"
                                                                 Value="True">
                                                        <Setter Property="Fill" Value="#fff" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Path.Style>
                                    </Path>

                                    <TextBlock Grid.Column="1"
                                               Padding="8 0"
                                               Text="for group members" />
                                </Grid>
                            </ToggleButton>
                        </UniformGrid>
                    </Grid>
                </Border>

                <!--  Whitelist  -->
                <Border Grid.Row="5"
                        Grid.ColumnSpan="2"
                        Margin="8 0 8 5"
                        Padding="10 5"
                        HorizontalAlignment="Stretch"
                        Background="#08ffffff"
                        CornerRadius="6">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Path Grid.RowSpan="2"
                              Width="14"
                              Height="14"
                              Margin="0 4 7 0"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Top"
                              Data="{StaticResource SvgWhitelist}"
                              Stretch="Uniform" />
                        <TextBlock Grid.Column="1"
                                   FontWeight="DemiBold"
                                   Foreground="#9fff"
                                   Text="Whitelist" />
                        <TextBlock Grid.Row="1"
                                   Grid.Column="1"
                                   FontSize="11"
                                   Foreground="#5fff"
                                   TextWrapping="Wrap">
                            <Run Text="When the 'Show all effects' settings are disabled, only whitelisted effects will be displayed. When updating this setting, previously untracked effects will not be displayed until they're refreshed in game." />
                        </TextBlock>

                        <Grid Grid.Row="3"
                              Grid.Column="1"
                              Margin="0 10 0 0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition Width="20" />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>

                            <Line Grid.RowSpan="2"
                                  Grid.Column="1"
                                  HorizontalAlignment="Stretch"
                                  Stretch="Fill"
                                  Stroke="#2fff"
                                  Y2="10" />

                            <TextBlock FontSize="10"
                                       TextWrapping="Wrap">
                                <Path Width="12"
                                      Height="8"
                                      Data="{StaticResource SvgUser}"
                                      Fill="#9fff" />

                                <Run FontSize="11"
                                     FontWeight="DemiBold"
                                     Foreground="#9fff"
                                     Text="Self whitelist" />
                                <LineBreak />
                                <Run Foreground="#5fff"
                                     Text="Enabling a class icon in self whitelist means that this effect will be displayed when" />
                                <Run FontWeight="DemiBold"
                                     Foreground="#9fff"
                                     Text="you" />
                                <Run Foreground="#5fff"
                                     Text="receive it while playing that specific class." />
                            </TextBlock>
                            <TextBlock Grid.Column="2"
                                       FontSize="10"
                                       TextWrapping="Wrap">
                                <Path Width="12"
                                      Height="8"
                                      Data="{StaticResource SvgUsers}"
                                      Fill="#9fff" />
                                <Run FontSize="11"
                                     FontWeight="DemiBold"
                                     Foreground="#9fff"
                                     Text="Group whitelist" />
                                <LineBreak />
                                <Run Foreground="#5fff"
                                     Text="Enabling a class icon in group whitelist means that this effect will be displayed when" />
                                <Run FontWeight="DemiBold"
                                     Foreground="#9fff"
                                     Text="the group member receiving it" />
                                <Run Foreground="#5fff"
                                     Text="is playing that specific class." />
                            </TextBlock>

                            <Border x:Name="SelfWhitelistContainer"
                                    Grid.Row="1"
                                    Margin="0 5"
                                    VerticalAlignment="Top"
                                    Background="#00ffffff"
                                    CornerRadius="0"
                                    IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.ShowAllOnSelf, Converter={converters1:BooleanInverter}}">
                                <Border.Resources>
                                    <Style BasedOn="{StaticResource {x:Type Path}}"
                                           TargetType="Path">
                                        <Setter Property="Fill" Value="#5fff" />
                                        <Setter Property="Margin" Value="0" />
                                        <Setter Property="Width" Value="16" />
                                        <Setter Property="Height" Value="16" />
                                        <Setter Property="Stretch" Value="Uniform" />
                                    </Style>
                                </Border.Resources>
                                <ItemsControl ItemTemplate="{StaticResource ClassToggleTemplate}"
                                              ItemsSource="{Binding SelfConfigurator.WhitelistToggles}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Rows="2" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                            </Border>

                            <Grid x:Name="SelfWhitelistDisabledWarning"
                                  Grid.Row="1"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  Visibility="Collapsed">
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <Path Width="16"
                                      Height="Auto"
                                      Data="{StaticResource SvgWarningRounded}"
                                      Fill="Orange" />
                                <TextBlock Grid.Row="1"
                                           Margin="0 3 0 0"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           FontSize="10"
                                           Foreground="Orange"
                                           Text="Whitelist is disabled because effects are not being filtered"
                                           TextAlignment="Center"
                                           TextWrapping="Wrap" />
                            </Grid>

                            <Border x:Name="GroupWhitelistContainer"
                                    Grid.Row="1"
                                    Grid.Column="2"
                                    Margin="0 5"
                                    VerticalAlignment="Top"
                                    Background="#00ffffff"
                                    CornerRadius="0">
                                <Border.Resources>
                                    <Style BasedOn="{StaticResource {x:Type Path}}"
                                           TargetType="Path">
                                        <Setter Property="Fill" Value="#5fff" />
                                        <Setter Property="Margin" Value="0" />
                                        <Setter Property="Width" Value="16" />
                                        <Setter Property="Height" Value="16" />
                                        <Setter Property="Stretch" Value="Uniform" />
                                    </Style>
                                </Border.Resources>
                                <ItemsControl ItemTemplate="{StaticResource ClassToggleTemplate}"
                                              ItemsSource="{Binding GroupConfigurator.WhitelistToggles}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Rows="2" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                            </Border>

                            <Grid x:Name="GroupWhitelistDisabledWarning"
                                  Grid.Row="1"
                                  Grid.Column="2"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  Visibility="Collapsed">
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <Path Width="16"
                                      Height="Auto"
                                      Data="{StaticResource SvgWarningRounded}"
                                      Fill="Orange" />
                                <TextBlock x:Name="GroupWhitelistDisabledWarningText"
                                           Grid.Row="1"
                                           Margin="0 3 0 0"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           FontSize="10"
                                           Foreground="Orange"
                                           Text="Whitelist is disabled because effects are not being filtered"
                                           TextAlignment="Center"
                                           TextWrapping="Wrap" />
                            </Grid>

                            <!--<TextBlock x:Name="GroupWhitelistDisabledWarningText"
                                       Grid.Row="1"
                                       Grid.Column="2"
                                       Margin="0 0 0 0"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       FontSize="10"
                                       Visibility="{Binding GroupConfigurator.CanBeWhitelisted, Converter={converters1:BoolToVisibility Invert=True}}"
                                       Foreground="#5fff"
                                       Text="Whitelist doesn't apply to debuffs on group members"
                                       TextAlignment="Center"
                                       TextWrapping="Wrap" />-->

                        </Grid>
                    </Grid>
                </Border>
                
            </Grid>
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding GroupConfigurator.CanBeWhitelisted}"
                             Value="False">
                    <Setter TargetName="GroupWhitelistContainer" Property="IsEnabled" Value="False" />
                    <Setter TargetName="GroupWhitelistDisabledWarning" Property="Visibility" Value="Visible" />
                    <Setter TargetName="GroupWhitelistDisabledWarningText" Property="Text" Value="Whitelist doesn't apply to debuffs on group members" />

                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.ShowAllOnSelf}"
                             Value="True">
                    <Setter TargetName="SelfWhitelistContainer" Property="Opacity" Value=".1" />
                    <Setter TargetName="SelfWhitelistDisabledWarning" Property="Visibility" Value="Visible" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.ShowAllOnGroup}"
                             Value="True">
                    <Setter TargetName="GroupWhitelistContainer" Property="IsEnabled" Value="False" />
                    <Setter TargetName="GroupWhitelistDisabledWarning" Property="Visibility" Value="Visible" />
                    <Setter TargetName="GroupWhitelistDisabledWarningText" Property="Text" Value="Whitelist is disabled because effects are not being filtered" />
                    <!--<Setter TargetName="GroupWhitelistDisabledWarningText" Property="Visibility" Value="Collapsed" />-->
                </DataTrigger>

            </DataTemplate.Triggers>
        </DataTemplate>

        <Style TargetType="ListBox">
            <Setter Property="ItemTemplate" Value="{StaticResource AbnormalityTemplate}" />
            <Setter Property="ItemContainerStyle" Value="{StaticResource DefaultListItemStyle}" />
            <Setter Property="Background" Value="#0000" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Margin" Value="-1" />
            <Setter Property="Padding" Value="0" />
        </Style>
    </Window.Resources>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="32" />
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition Width=".80*" />
        </Grid.ColumnDefinitions>
        <Border Grid.RowSpan="3"
                Grid.ColumnSpan="2"
                Margin="-5"
                Opacity="1"
                Style="{StaticResource RevampBorderStyle}" />
        <!--  Title bar  -->
        <Grid Grid.ColumnSpan="2"
              Margin="5 0"
              Background="Transparent"
              MouseLeftButtonDown="Drag">
            <Button Margin="0 5"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Stretch"
                    VerticalContentAlignment="Center"
                    Click="Close"
                    Style="{StaticResource NostrumContentOpacityButtonStyle}">
                <Path Margin="3"
                      Data="{StaticResource SvgClose}" />
            </Button>
            <Path Style="{StaticResource WindowLogo}" />
            <TextBlock Margin="34 0 0 0"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Center"
                       FontSize="15"
                       Foreground="#999"
                       Style="{StaticResource DefaultTextStyle}"
                       Text="{Binding Title, RelativeSource={RelativeSource AncestorType=abnormWin:AbnormalityConfigWindow}}" />
        </Grid>
        <!--  List  -->
        <Border x:Name="ListBoxBorder"
                Grid.Row="1"
                Margin="5"
                Padding="0"
                Background="{StaticResource RevampDarkerBackground50Brush}"
                CornerRadius="8">

            <ListBox x:Name="ListBox"
                     AlternationCount="2"
                     ItemsSource="{Binding AbnormalitiesView}"
                     SelectedItem="{Binding SelectedAbnormality, Mode=TwoWay}">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="{x:Type ListBoxItem}">
                        <Setter Property="HorizontalAlignment" Value="Stretch" />
                        <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                        <Setter Property="Padding" Value="4" />
                        <Setter Property="Margin" Value="2 2 2 0" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                    <Grid Background="Transparent">
                                        <Rectangle x:Name="alt"
                                                   Fill="#1779"
                                                   IsHitTestVisible="False"
                                                   Opacity="0"
                                                   RadiusX="6"
                                                   RadiusY="6" />
                                        <Rectangle x:Name="hl"
                                                   Fill="{StaticResource DefensiveStanceBrushDark}"
                                                   IsHitTestVisible="False"
                                                   Opacity="0"
                                                   RadiusX="6"
                                                   RadiusY="6" />
                                        <ContentPresenter Margin="{TemplateBinding Padding}" />
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="hl" Property="Opacity" Value=".3" />
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="hl" Property="Opacity" Value="1" />
                                        </Trigger>
                                        <Trigger Property="ItemsControl.AlternationIndex" Value="0">
                                            <Setter TargetName="alt" Property="Opacity" Value="0" />
                                        </Trigger>
                                        <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                                            <Setter TargetName="alt" Property="Opacity" Value="1" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </Border>
        <!--  Search  -->
        <Border Grid.Row="2"
                Margin="5"
                Padding="4"
                Background="{StaticResource RevampDarkerBackground50Brush}"
                CornerRadius="8">
            <Grid HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBox Margin="4 0"
                         VerticalContentAlignment="Center"
                         Background="Transparent"
                         BorderThickness="0"
                         CaretBrush="#8fff"
                         Foreground="#bfff"
                         Text="{Binding SearchFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                <TextBlock Margin="6 0"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           IsHitTestVisible="False"
                           Foreground="#2fff"
                           Text="Search by name or id...">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SearchFilter}"
                                             Value="">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                <Button x:Name="FilterButton"
                        Grid.Column="1"
                        Padding="6"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        extensions:ButtonExtensions.CornerRadius="4"
                        extensions:ButtonExtensions.HighlightBrush="#1fff"
                        Click="FilterButton_OnClick">
                    <Button.Style>
                        <Style BasedOn="{StaticResource NostrumMainButtonStyle}"
                               TargetType="Button">
                            <Setter Property="Foreground" Value="#9fff" />
                            <Setter Property="Background" Value="Transparent" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsFiltering}"
                                             Value="True">
                                    <Setter Property="Foreground" Value="White" />
                                    <Setter Property="Background" Value="{StaticResource DefensiveStanceBrush}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Path Width="12"
                          Height="12"
                          Data="{StaticResource SvgFilterListRounded}"
                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" />
                </Button>

                <Popup x:Name="FilterPopup"
                       AllowsTransparency="True"
                       HorizontalOffset="0"
                       Placement="Top"
                       PlacementTarget="{Binding ElementName=FilterButton}"
                       PopupAnimation="Fade"
                       StaysOpen="False"
                       VerticalOffset="-10">
                    <Border Margin="15"
                            Padding="8"
                            Background="{StaticResource RevampBackgroundBrush}"
                            CornerRadius="8">
                        <Border.Resources>
                            <Style BasedOn="{StaticResource {x:Type ToggleButton}}"
                                   TargetType="{x:Type ToggleButton}">
                                <Setter Property="controls:ToggleButtonExtensions.HighlightBrush" Value="#2fff" />
                                <Setter Property="controls:ToggleButtonExtensions.CornerRadius" Value="4" />
                                <Setter Property="Background" Value="#1fff" />
                            </Style>
                        </Border.Resources>
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="15"
                                              Opacity=".4"
                                              ShadowDepth="0" />
                        </Border.Effect>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid Margin="0 0 0 4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="24" />
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>
                                <Path Width="Auto"
                                      Height="Auto"
                                      Margin="5"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"
                                      Data="{StaticResource SvgFilterListRounded}" />
                                <TextBlock Grid.Column="1"
                                           Margin="5 0"
                                           VerticalAlignment="Center"
                                           Foreground="#fff"
                                           Text="Filter by" />
                            </Grid>
                            <Grid Grid.Row="1"
                                  Margin="29 0 0 0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Margin="0 0 8 0"
                                           VerticalAlignment="Center"
                                           Foreground="#9fff"
                                           Text="favorite" />
                                <ToggleButton Grid.Column="1"
                                              Width="24"
                                              Height="24"
                                              Margin="0"
                                              Padding="6"
                                              IsChecked="{Binding FilterFavorites, Mode=TwoWay}">
                                    <Path Data="{StaticResource SvgStar}"
                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=ToggleButton}, Path=Foreground}" />
                                </ToggleButton>
                            </Grid>
                            <Grid Grid.Row="2"
                                  Margin="29 4 0 0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Margin="0 0 8 0"
                                           VerticalAlignment="Center"
                                           Foreground="#9fff"
                                           Text="whitelisted" />
                                <ToggleButton Grid.Column="1"
                                              Width="24"
                                              Height="24"
                                              Margin="4 0"
                                              Padding="7"
                                              IsChecked="{Binding FilterSelfWhitelisted, Mode=TwoWay}">
                                    <Path Data="{StaticResource SvgUser}"
                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=ToggleButton}, Path=Foreground}" />
                                </ToggleButton>
                                <ToggleButton Grid.Column="2"
                                              Width="24"
                                              Height="24"
                                              Padding="6"
                                              IsChecked="{Binding FilterGroupWhitelisted, Mode=TwoWay}">
                                    <Path Data="{StaticResource SvgUsers}"
                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=ToggleButton}, Path=Foreground}" />
                                </ToggleButton>
                            </Grid>
                            <Grid Grid.Row="3"
                                  Margin="29 4 0 0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Margin="0 0 8 0"
                                           VerticalAlignment="Center"
                                           Foreground="#9fff"
                                           Text="collapsible" />

                                <ToggleButton Grid.Column="1"
                                              Width="24"
                                              Height="24"
                                              Margin="4 0"
                                              Padding="7"
                                              IsChecked="{Binding FilterSelfCollapsible, Mode=TwoWay}">
                                    <Path Data="{StaticResource SvgUser}"
                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=ToggleButton}, Path=Foreground}" />
                                </ToggleButton>
                                <ToggleButton Grid.Column="2"
                                              Width="24"
                                              Height="24"
                                              Padding="4"
                                              IsChecked="{Binding FilterGroupCollapsible, Mode=TwoWay}">
                                    <Path Width="14"
                                          Height="14"
                                          Data="{StaticResource SvgUsers}"
                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=ToggleButton}, Path=Foreground}" />
                                </ToggleButton>
                            </Grid>
                        </Grid>
                    </Border>
                </Popup>
            </Grid>
        </Border>
        <!--  Details  -->
        <Border Grid.Row="1"
                Grid.Column="1"
                Margin="5"
                Padding="0"
                Background="{StaticResource RevampDarkerBackground50Brush}"
                ClipToBounds="False"
                CornerRadius="8">
            <ContentControl VerticalAlignment="Top"
                            ClipToBounds="False"
                            Content="{Binding ElementName=ListBox, Path=SelectedValue}"
                            ContentTemplate="{StaticResource AbnormalityDetailsTemplate}" />
        </Border>
        <!--  Show all  -->
        <Border Grid.Row="2"
                Grid.Column="1"
                Margin="5"
                Padding="5 4"
                Background="{StaticResource RevampDarkerBackground50Brush}"
                CornerRadius="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Path Grid.Column="3"
                      Width="16"
                      Height="16"
                      Margin="7 0 4 0"
                      Data="{StaticResource SvgWarningRounded}"
                      Fill="#5fff"
                      ToolTip="WARNING: showing all effects will affect TCC performance."
                      ToolTipService.InitialShowDelay="0"
                      ToolTipService.Placement="Top" />
                <TextBlock Grid.Column="0"
                           Margin="4 0"
                           VerticalAlignment="Center"
                           Foreground="#9fff"
                           Text="Show all effects:" />
                <ToggleButton Grid.Column="1"
                              Margin="5 0 5 0"
                              VerticalAlignment="Stretch"
                              HorizontalContentAlignment="Center"
                              controls:ToggleButtonExtensions.CornerRadius="6"
                              controls:ToggleButtonExtensions.HighlightBrush="#1fff"
                              Background="#1fff"
                              FontWeight="DemiBold"
                              IsChecked="{Binding ShowAllOnSelf, Mode=TwoWay}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Path Height="10"
                              Margin="0 0 5 -2"
                              Data="{StaticResource SvgUser}"
                              Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}" />
                        <TextBlock Grid.Column="1"
                                   Text="on yourself" />
                    </Grid>
                </ToggleButton>
                <ToggleButton Grid.Column="2"
                              VerticalAlignment="Stretch"
                              controls:ToggleButtonExtensions.CornerRadius="6"
                              controls:ToggleButtonExtensions.HighlightBrush="#1fff"
                              Background="#1fff"
                              FontWeight="DemiBold"
                              IsChecked="{Binding ShowAllOnGroup, Mode=TwoWay}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Path Height="10"
                              Margin="0 0 5 -2"
                              Data="{StaticResource SvgUsers}"
                              Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=ToggleButton}}" />
                        <TextBlock Grid.Column="1"
                                   Text="on group members" />
                    </Grid>
                </ToggleButton>
            </Grid>
        </Border>
    </Grid>
</local:TccWindow>